// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserType {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       User[]

  @@map("user_types")
}

model Language {
  id        String        @id @default(cuid())
  publicId  String        @unique @default(cuid())
  name      String        @unique
  folder    String
  iso2      String        @unique @db.VarChar(2)
  iso3      String        @unique @db.VarChar(3)
  flagImage String
  direction String        @default("ltr") @db.VarChar(3)
  status    Boolean       @default(true)
  isDefault DefaultStatus @default(YES)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  users                       User[]
  manageDropdowns             ManageDropdown[]
  sliders                     Slider[]
  revenueSubscriptionLanguages RevenueSubscriptionLanguage[]
  metaSettings                MetaSetting[]
  emailTemplates              EmailTemplate[]

  @@index([name])
  @@index([folder])
  @@index([iso2])
  @@index([iso3])
  @@index([direction])
  @@index([status])
  @@index([isDefault])
  @@index([createdAt])
  @@index([publicId])
  @@index([name, iso2, iso3])
  @@map("languages")
}

model User {
  id                            String      @id @default(cuid())
  publicId                      String      @unique @default(cuid()) // For public API access
  firstName                     String
  lastName                      String
  slug                          String?     @unique
  photo                         String?
  coverPhoto                    String?
  email                         String      @unique
  password                      String
  phoneNumber                   String?
  userLocation                  String?
  zipcode                       String?
  kycStatus                     String?
  kycReferenceId                String?
  aboutYourself                 String?
  outsideLinks                  String?     // JSON string of {title: string, url: string}[]
  userTypeId                    String?
  userType                      UserType?   @relation(fields: [userTypeId], references: [id])
  active                        ActiveStatus @default(PENDING)
  enableTwoFactorAuth           String      @default("no")
  appliedBytwoFactorAuth        String      @default("no")
  twoFactorAuthVerified         String      @default("yes")
  twoFactorSecretKey            String?
  signupIpAddress               String?
  loginIpAddress                String?
  uniqueGoogleId                String?
  uniqueLinkedInId              String?
  uniqueFacebookId              String?
  uniqueTwitterId               String?
  achCustomerId                 String?
  achAccountId                  String?
  achAccountStatus              String?
  isAdmin                       String?
  accountActivationToken        String?
  passwordChangedAt             DateTime?
  passwordResetToken            String?
  passwordResetExpires          DateTime?
  walletId                      String?
  mangoPayOwnerId               String?
  mangoPayOwnerWalletId         String?
  plaidDwollaCustomerId         String?
  plaidDwollFundingSourceId     String?
  plaidDwollFundingSourceStatus String?
  plaidDwollaKYCStatus          String?
  globalSocketId                String?
  enableNotification            NotificationStatus @default(YES)
  notificationLanguageId        String?
  notificationLanguage          Language?   @relation(fields: [notificationLanguageId], references: [id])
  walletAddress                 String?
  equityCampaigns               Equity[]
  createdAt                     DateTime    @default(now())
  updatedAt                     DateTime    @updatedAt

  // Indexes as mentioned in original schema
  @@index([active])
  @@index([email])
  @@index([firstName])
  @@index([lastName])
  @@index([signupIpAddress])
  @@index([userTypeId])
  @@index([publicId])
  @@index([active, id])
  @@index([firstName, lastName, email, signupIpAddress, id])
  @@map("users")
}

enum ActiveStatus {
  PENDING
  ACTIVE
  INACTIVE
  DELETED
}

enum NotificationStatus {
  YES
  NO
}

enum CampaignStatus {
  DRAFT
  PENDING
  ACTIVE
  REJECT
  SUCCESSFUL
  UNSUCCESSFUL
  HIDDEN
  INACTIVE
}

enum UploadType {
  IMAGE
  VIDEO
}

enum AccountType {
  CURRENT_ACCOUNT
  SAVING_ACCOUNT
}

enum TermSlug {
  EQUITY_DIVIDEND
  EQUITY
  DEBT
}

enum RecordType {
  STRING
  FILE
}

enum DefaultStatus {
  YES
  NO
}

enum AIGeneratedStatus {
  YES
  NO
}

enum SubscriptionType {
  INVESTOR
  SPONSOR
}

// Equity Campaign Model
model Equity {
  id                      String         @id @default(cuid())
  publicId               String         @unique @default(cuid()) // For public API access
  
  // Step 1: Company Information
  companyLogo            String
  companyName            String
  companySlug            String?
  companyTagline         String
  companyEmail           String
  companyPhoneNumber     String
  companyAddress         String
  yearFounded            Int
  website                String?
  companyCategory        String
  companyIndustry        String
  companyDescription     String         @db.Text
  userId                 String
  user                   User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  status                 CampaignStatus @default(DRAFT)

  // Step 2: Fundraising Details
  isUpcomingCampaign     Boolean
  projectTimezone        String?
  startDate              DateTime?
  startTime              String?
  actualStartDateTime    DateTime?
  currencyId             String
  goal                   Decimal        @db.Decimal(15,2)
  closingDate            DateTime
  minimumRaise           Decimal        @db.Decimal(15,2)
  maximumRaise           Decimal        @db.Decimal(15,2)
  campaignStage          String
  industry               String
  previouslyRaised       Decimal?       @db.Decimal(15,2)
  estimatedRevenue       Decimal?       @db.Decimal(15,2)
  hasLeadInvestor        Boolean
  termId                 String
  termslug               TermSlug

  // Term-specific fields
  availableShares        Int?
  pricePerShare          Decimal?       @db.Decimal(10,2)
  preMoneyValuation      Decimal?       @db.Decimal(15,2)
  maturityDate           DateTime?
  investFrequency        String?
  IRR                    Decimal?       @db.Decimal(5,2)
  equityAvailable        Decimal?       @db.Decimal(5,2)
  interestRate           Decimal?       @db.Decimal(5,2)
  termLength             Int?

  // Step 3: Project Story
  uploadType             UploadType?
  campaignImageURL       String?
  campaignVideoURL       String?
  campaignStory          String?        @db.Text

  // Step 5: Extras
  googleAnalyticsID      String?
  additionalLinks        Json?          // Array of {linkTitle, linkUrl}

  // Step 6: Investment Info
  bankName               String?
  accountType            AccountType?
  accountHolderName      String?
  accountNumber          String?
  confirmAccountNumber   String?
  routingNumber          String?

  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt

  // Relations
  leadInvestors          LeadInvestor[]
  teamMembers            TeamMember[]
  campaignFaqs           CampaignFaq[]
  extrasVideos           ExtrasVideo[]
  extrasImages           ExtrasImage[]
  extrasDocuments        ExtrasDocument[]

  @@index([userId])
  @@index([status])
  @@index([publicId])
  @@index([companySlug])
  @@index([userId, status])
  @@map("campaigns")
}

// Lead Investor Model
model LeadInvestor {
  id              String   @id @default(cuid())
  publicId        String   @unique @default(cuid())
  investorPhoto   String
  name            String
  investorType    String
  bio             String   @db.Text
  equityId        String
  equity          Equity   @relation(fields: [equityId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([equityId])
  @@map("lead_investors")
}

// Team Member Model
model TeamMember {
  id           String   @id @default(cuid())
  publicId     String   @unique @default(cuid())
  memberPhoto  String
  name         String
  role         String
  email        String
  bio          String   @db.Text
  equityId     String
  equity       Equity   @relation(fields: [equityId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([equityId])
  @@map("team_members")
}

// Campaign FAQ Model
model CampaignFaq {
  id                String   @id @default(cuid())
  publicId          String   @unique @default(cuid())
  questionID        String?  // Foreign key to Faqs module
  answer            String?  @db.Text
  customQuestion    String?  @db.Text
  customAnswer      String?  @db.Text
  equityId          String
  equity            Equity   @relation(fields: [equityId], references: [id], onDelete: Cascade)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([equityId])
  @@map("campaign_faqs")
}

// Extras Video Model
model ExtrasVideo {
  id                String   @id @default(cuid())
  publicId          String   @unique @default(cuid())
  videoUrl          String
  videoTitle        String
  videoDescription  String   @db.Text
  equityId          String
  equity            Equity   @relation(fields: [equityId], references: [id], onDelete: Cascade)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([equityId])
  @@map("extras_videos")
}

// Extras Image Model
model ExtrasImage {
  id                String   @id @default(cuid())
  publicId          String   @unique @default(cuid())
  imageUrl          String
  imageTitle        String
  imageDescription  String   @db.Text
  equityId          String
  equity            Equity   @relation(fields: [equityId], references: [id], onDelete: Cascade)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([equityId])
  @@map("extras_images")
}

// Extras Document Model
model ExtrasDocument {
  id             String   @id @default(cuid())
  publicId       String   @unique @default(cuid())
  documentUrl    String
  documentTitle  String
  equityId       String
  equity         Equity   @relation(fields: [equityId], references: [id], onDelete: Cascade)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([equityId])
  @@map("extras_documents")
}

// Admin Model
model Admin {
  id                      String    @id @default(cuid())
  publicId               String    @unique @default(cuid())
  firstName              String
  lastName               String
  email                  String    @unique
  photo                  String?
  password               String
  passwordChangedAt      DateTime?
  passwordResetToken     String?
  passwordResetExpires   DateTime?
  active                 Boolean   @default(true)
  loginIpAddress         String?
  currentLoginDateTime   DateTime?
  lastLoginDateTime      DateTime?
  twoFactorAuthVerified  Boolean   @default(false)
  twoFactorSecretKey     String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([email])
  @@index([firstName])
  @@index([lastName])
  @@index([active])
  @@index([publicId])
  @@index([active, id])
  @@index([firstName, lastName, email, id])
  @@map("admins")
}

// Master Dropdown Model
model ManageDropdown {
  id           String    @id @default(cuid())
  publicId     String    @unique @default(cuid()) // For public API access
  name         String
  uniqueCode   Int       // Required 10-digit unique code (removed @unique)
  dropdownType String
  languageId   String
  language     Language  @relation(fields: [languageId], references: [id], onDelete: Cascade)
  status       Boolean   @default(true)
  useCount     Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@unique([uniqueCode, languageId]) // Composite unique constraint
  @@index([dropdownType])
  @@index([languageId])
  @@index([status])
  @@index([uniqueCode])
  @@index([dropdownType, languageId])
  @@index([dropdownType, status])
  @@index([publicId])
  @@map("manage_dropdowns")
}
// Settings Model
model Settings {
  id         String     @id @default(cuid())
  groupType  String
  recordType RecordType @default(STRING)
  key        String
  value      String     @db.Text
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  @@unique([groupType, key])
  @@index([groupType])
  @@map("settings")
}

// Country Model
model Country {
  id        String        @id @default(cuid())
  publicId  String        @unique @default(cuid())
  name      String
  iso2      String        @unique @db.VarChar(2)
  iso3      String        @unique @db.VarChar(3)
  flag      String
  isDefault DefaultStatus @default(NO)
  status    Boolean       @default(true)
  useCount  Int           @default(0)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([name])
  @@index([iso2])
  @@index([iso3])
  @@index([isDefault])
  @@index([status])
  @@index([useCount])
  @@index([createdAt])
  @@index([publicId])
  @@index([name, iso2, iso3])
  @@map("countries")
}

// Currency Model
model Currency {
  id        String   @id @default(cuid())
  publicId  String   @unique @default(cuid())
  name      String   @unique
  code      String   @unique @db.VarChar(3) // ISO currency code (USD, EUR, etc.)
  symbol    String   // Currency symbol ($, €, £, etc.)
  status    Boolean  @default(true)
  useCount  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([code])
  @@index([symbol])
  @@index([status])
  @@index([useCount])
  @@index([createdAt])
  @@index([publicId])
  @@index([name, code])
  @@map("currencies")
}

// Slider Model
model Slider {
  id                 String   @id @default(cuid())
  publicId           String   @unique @default(cuid()) // For public API access
  uniqueCode         Int                                 // Required for grouping same slider across languages
  sliderImage        String                             // Image file path
  title              String                             // Slider title
  description        String   @db.Text                  // Slider description
  buttonTitle        String                             // Button text
  buttonLink         String                             // Button URL/link
  languageId         String                             // Foreign key to Language.id
  language           Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  customColor        Boolean  @default(false)           // Whether to use custom colors
  titleColor         String   @default("#000000")       // Title text color
  descriptionColor   String   @default("#000000")       // Description text color
  buttonTitleColor   String   @default("#FFFFFF")       // Button text color
  buttonLinkColor    String   @default("#007BFF")       // Button background color
  status             Boolean  @default(true)            // Active/inactive status
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@unique([uniqueCode, languageId]) // Composite unique constraint
  @@index([uniqueCode])
  @@index([languageId])
  @@index([status])
  @@index([uniqueCode, languageId])
  @@index([languageId, status])
  @@index([publicId])
  @@index([createdAt])
  @@map("sliders")
}

// Revenue Subscription Model
model RevenueSubscription {
  id                      String           @id @default(cuid())
  publicId                String           @unique @default(cuid())
  subscriptionType        SubscriptionType
  amount                  Decimal          @db.Decimal(10,2)
  maxInvestmentAllowed    Decimal?         @db.Decimal(15,2) // Required only for INVESTOR
  maxProjectAllowed       Int?                               // Required only for SPONSOR
  maxProjectGoalLimit     Decimal?         @db.Decimal(15,2) // Required only for SPONSOR
  allowRefund             Boolean          @default(true)
  allowRefundDays         Int?                               // Required only when allowRefund is true
  allowCancel             Boolean          @default(true)
  allowCancelDays         Int?                               // Required only when allowCancel is true
  secondaryMarketAccess   Boolean?                           // Required only for INVESTOR
  earlyBirdAccess         Boolean          @default(true)
  useCount                Int              @default(0)
  status                  Boolean          @default(true)
  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt

  // Relations
  languageContents        RevenueSubscriptionLanguage[]

  @@index([publicId])
  @@index([subscriptionType])
  @@index([status])
  @@index([useCount])
  @@index([subscriptionType, status])
  @@index([createdAt])
  @@map("revenue_subscriptions")
}

// Revenue Subscription Language Model
model RevenueSubscriptionLanguage {
  id                 String              @id @default(cuid())
  publicId           String              @unique @default(cuid())
  mainSubscriptionId String
  mainSubscription   RevenueSubscription @relation(fields: [mainSubscriptionId], references: [id], onDelete: Cascade)
  title              String
  description        String              @db.Text
  languageId         String
  language           Language            @relation(fields: [languageId], references: [id], onDelete: Cascade)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  @@unique([mainSubscriptionId, languageId]) // One content per subscription per language
  @@index([mainSubscriptionId])
  @@index([languageId])
  @@index([mainSubscriptionId, languageId])
  @@index([publicId])
  @@index([createdAt])
  @@map("revenue_subscription_languages")
}

// Meta Setting Model
model MetaSetting {
  id                   String            @id @default(cuid())
  publicId             String            @unique @default(cuid())
  languageId           String            @unique // One meta setting per language
  siteName             String
  metaTitle            String
  metaDescription      String            @db.Text
  metaKeyword          String            @db.Text
  ogTitle              String
  ogDescription        String            @db.Text
  ogImage              String
  isAIGeneratedImage   AIGeneratedStatus @default(NO)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt

  // Relations
  language             Language          @relation(fields: [languageId], references: [id], onDelete: Cascade)

  @@index([languageId])
  @@index([publicId])
  @@index([createdAt])
  @@map("meta_settings")
}

// Email Template Model
model EmailTemplate {
  id              String   @id @default(cuid())
  publicId        String   @unique @default(cuid())
  languageId      String   // Allow multiple email templates per language
  task            String   @db.VarChar(100) // Immutable after creation (e.g., "welcome_email", "password_reset")
  senderEmail     String   @db.VarChar(255)
  replyEmail      String   @db.VarChar(255)
  senderName      String   @db.VarChar(200)
  subject         String   @db.VarChar(500)
  message         String   @db.Text
  status          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  language        Language @relation(fields: [languageId], references: [id], onDelete: Cascade)

  @@unique([task, languageId]) // One email template per task per language
  @@index([languageId])
  @@index([publicId])
  @@index([task])
  @@index([status])
  @@index([task, languageId])
  @@index([status, languageId])
  @@index([createdAt])
  @@map("email_templates")
}

enum PaymentMode {
  sandbox
  live
}

model PaymentGateway {
  id             String      @id @default(cuid())
  publicId       String      @unique @default(cuid())
  title          String
  paymentSlug    String      @unique
  paymentMode    PaymentMode
  sandboxDetails Json        @default("{}")
  liveDetails    Json        @default("{}")
  isDefault      Boolean     @default(false)
  status         Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@index([paymentSlug])
  @@index([status])
  @@index([isDefault])
  @@index([paymentMode])
  @@index([title])
  @@index([publicId])
  @@index([createdAt])
  @@index([paymentSlug, status])
  @@index([status, isDefault])
  @@map("payment_gateways")
}

